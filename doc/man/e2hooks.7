.\" Man page for e2 hooks
.\"
.\" (c)2007 emlix GmbH
.\"
.TH e2hook 7 "Aug 2, 2007" "0.1"

.SH NAME
e2hooks \- Hooks available in the e2 build system

.SH DESCRIPTION
During execution of \fBe2\fR commands a number of "hook" scripts are
called, if available, to perform any site-specific customization of
the build process. Hook scripts are located in the "hooks"
subdirectory of the project and will be loaded and evaluated as Lua
code. Global tools do not nocessarily execute in a project directory
and will load and evaluate hooks in the \fB$HOME/.e2/hooks\fR
directory, if it exists. Hook-specific arguments are passed as a table
in the global "e2hook" table under the key "arguments". The project
info structure (not necessarily complete) is stored under the key
"info" in the "e2hook" table. Finally, the name of the currently
invoked tool can be found under "toolname" in the said table.

Note, that hooks are not intended to add functionality changing the
build process itself.  It is an error to let a hook do anything that
changes the outcome of the build process.  Instead, hooks may be used
to trigger actions in the environment of the build process.

.SH HOOKS

.TP
.BR tool\-start
Called when a local tool executes (after command-line processing, but
before the actual operations begin). Note that the \fBe2hook.info\fR
entry may be \fBnil\fR if this hook is triggered in a global tool.

.TP
.BR tool\-finish
Called after a local tool executed without an error. If an error
occurred, this hook will not run. Note that the \fBe2hook.info\fR
entry may be \fBnil\fR if this hook is triggered in a global tool.

.TP
.BR pre\-build
Called before an \fBe2-build(1)\fR command commences. Arguments are
given in a table with the following keys:

.nf
  info = <project info structure>
  result = <table of results>
  tags = <bool>
  heads = <bool>
  playground = <resultname or false>
.fi

.TP
.BR post\-build
Called after \fBe2-build(1)\fR finishes, with the same arguments as
"pre-build".

.TP
.BR build\-setup\-chroot
Called after the chroot(1) environment has been set up for building a
single result. The argument is a build configuration table. 

.TP
.BR build\-pre\-runbuild
Called before starting the actual build-script inside the chroot(1)
environment for a single result. The argument is the build configuration table.

.TP
.BR build\-post\-runbuild
Called after the build-script of a single result has completed. Argument
is the build configuration table.

.TP
.BR build\-remove\-chroot
Called before the chroot(1) environment for a single result is removed.
Argument is the build configuration table.

.TP
.BR build\-pre\-sources
Called before the sources are applied into the chroot(1) environment for
a single result. Argument is the build configuration table.

.TP
.BR build\-post\-sources
Called after the sources have been applied into the chroot(1) environment.

.TP
.BR build\-failure
Called when the build script of a result fails. Argument is the build 
configuration table.

.TP
.BR files\-prepare\-source
Called once after preparing each single source file for files sources.
The argument table carries the entries \fBsource\fR (source name),
\fBfile\fR (file name) and \fBpath\fR (build path).

.TP 
.BR build\-pre\-result
Called before a single result is build. Argument is the build configuration
table.

.TP 
.BR build\-post\-result
Called after a single result is build. Argument is the build configuration
table.

.TP
.BR create\-project
Called after a base project has been cloned by \fBe2-create-project(1)\fR
and before it is stored on the project server.
The argument is the root path of the project. The "info" entry in
the "e2hook" table is incomplete for this hook.

.TP
.BR fetch\-project
Called after fetching a project with \fBe2-fetch-project(1)\fR. The argument
is the root path of the project. The "info" entry in
the "e2hook" table is incomplete for this hook.

.TP
.BR fetch\-sources
Called after fetching sources with \fBe2-fetch-sources(1)\fR. The argument
is a table containing the requested sources.

.TP
.BR enter\-playground
Called before entering a chroot(1) environment via \fBe2-playground(1)\fR.
The argument is the path where the chroot environment is located.

.TP
.BR use\-source
Called after a new source is inserted into an existing project by 
\fBe2-use-source(1)\fR. The argument is a table with the following entries:

.nf
  type = <source type string>
  server = <server name>
  remote = <server path>
  working = <working directory>
  branch = <branch name>
  tag = <tag name>
.fi

.SH "HOOK ORDER"
Build-related hooks are run in the following order:

.nf
  pre-build
    build-pre-result                 (once for each result)
    build-setup-chroot
    build-pre-sources
    build-post-sources
    build-pre-runbuild
    build-post-runbuild
    build-post-result
    build-remove-chroot
  post-build
.fi

.SH BUGS

When \fBe2-new-source\fR is invoked without the \fB--source\fR option,
then the \fBtool-start\fR and \fBtool-finish\fR hooks will not execute.

Doubtless there are many others.

.SH "SEE ALSO"
.BR e2intro(7)
.BR e2-build(1)
.BR e2-create-project(1)
.BR e2-fetch-project(1)
.BR e2-fetch-sources(1)
.BR e2-playground(1)
.BR e2-use-source(1)

.SH AUTHORS
Gordon Hecker, Oskar Schirmer and Felix Winkelmann

.SH COPYRIGHT
(c)2007 emlix GmbH
